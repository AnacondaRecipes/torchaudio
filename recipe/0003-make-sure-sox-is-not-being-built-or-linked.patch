From 97ca69c81f9b6d10dabe3103cf4797316b945c8f Mon Sep 17 00:00:00 2001
From: Jack Olivieri <jolivieri@anaconda.com>
Date: Mon, 1 Jul 2024 11:41:25 +0200
Subject: [PATCH] make sure sox is not being built or linked

---
 CMakeLists.txt                   | 2 ++
 tools/setup_helpers/extension.py | 4 +++-
 2 files changed, 5 insertions(+), 1 deletion(-)

diff --git a/CMakeLists.txt b/CMakeLists.txt
index 5c8fe156..c34f3049 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -53,6 +53,8 @@ endif()
 
 # Options
 option(BUILD_SOX "Build libsox statically" OFF)
+# really making sure sox is disabled and isn't being built or linked
+SET(BUILD_SOX OFF CACHE BOOL "Build libsox into libtorchaudio")
 option(BUILD_RIR "Enable RIR simulation" ON)
 option(BUILD_RNNT "Enable RNN transducer" ON)
 option(BUILD_ALIGN "Enable forced alignment" ON)
diff --git a/tools/setup_helpers/extension.py b/tools/setup_helpers/extension.py
index 2415bbae..1bf51fec 100644
--- a/tools/setup_helpers/extension.py
+++ b/tools/setup_helpers/extension.py
@@ -34,7 +34,9 @@ def _get_build(var, default=False):
 
 
 _BUILD_CPP_TEST = _get_build("BUILD_CPP_TEST", False)
-_BUILD_SOX = False if platform.system() == "Windows" else _get_build("BUILD_SOX", True)
+#_BUILD_SOX = False if platform.system() == "Windows" else _get_build("BUILD_SOX", True)
+# really making sure sox is disabled and isn't being built or linked
+_BUILD_SOX = False
 _BUILD_RIR = _get_build("BUILD_RIR", True)
 _BUILD_RNNT = _get_build("BUILD_RNNT", True)
 _USE_FFMPEG = _get_build("USE_FFMPEG", True)
-- 
2.39.3 (Apple Git-146)

