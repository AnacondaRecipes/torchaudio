From 749175a09a460821ae03fb5634d3ec9bf8dabbe0 Mon Sep 17 00:00:00 2001
From: Jack Olivieri <jolivieri@anaconda.com>
Date: Mon, 1 Jul 2024 12:28:54 +0200
Subject: [PATCH 1/2] support ffmpeg and not sox

---
 CMakeLists.txt                   | 6 ++++--
 tools/setup_helpers/extension.py | 4 +++-
 2 files changed, 7 insertions(+), 3 deletions(-)

diff --git a/CMakeLists.txt b/CMakeLists.txt
index f0195c87..a9457700 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -52,13 +52,15 @@ endif()
 
 
 # Options
-option(BUILD_SOX "Build libsox statically" ON)
+option(BUILD_SOX "Build libsox statically" OFF)
+# really making sure sox is disabled and isn't being built or linked
+SET(BUILD_SOX OFF CACHE BOOL "Build libsox into libtorchaudio")
 option(BUILD_RIR "Enable RIR simulation" ON)
 option(BUILD_RNNT "Enable RNN transducer" ON)
 option(BUILD_ALIGN "Enable forced alignment" ON)
 option(BUILD_CUDA_CTC_DECODER "Build CUCTC decoder" OFF)
 option(BUILD_TORCHAUDIO_PYTHON_EXTENSION "Build Python extension" OFF)
-option(USE_FFMPEG "Enable ffmpeg-based features" OFF)
+option(USE_FFMPEG "Enable ffmpeg-based features" ON)
 option(USE_CUDA "Enable CUDA support" OFF)
 option(USE_ROCM "Enable ROCM support" OFF)
 option(USE_OPENMP "Enable OpenMP support" OFF)
diff --git a/tools/setup_helpers/extension.py b/tools/setup_helpers/extension.py
index c0768ce8..c7745b0f 100644
--- a/tools/setup_helpers/extension.py
+++ b/tools/setup_helpers/extension.py
@@ -33,7 +33,9 @@ def _get_build(var, default=False):
     return False
 
 
-_BUILD_SOX = False if platform.system() == "Windows" else _get_build("BUILD_SOX", True)
+#_BUILD_SOX = False if platform.system() == "Windows" else _get_build("BUILD_SOX", True)
+# really making sure sox is disabled and isn't being built or linked
+_BUILD_SOX = False
 _BUILD_RIR = _get_build("BUILD_RIR", True)
 _BUILD_RNNT = _get_build("BUILD_RNNT", True)
 _USE_FFMPEG = _get_build("USE_FFMPEG", True)
-- 
2.39.3 (Apple Git-146)

